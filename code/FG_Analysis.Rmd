---
title: "Faville Grove Analysis"
author: "Kendall Beals"
date: "2023-02-28"
output:
  html_document: default
  pdf_document: default
---

**The project objectives and hypotheses will go here.**

First, install and/or load in the following packages. Multiple packages can be loaded simultaneously using the p_load function in the pacman package.  
```{r}
r = getOption("repos")
r["CRAN"] = "http://cran.us.r-project.org"
options(repos = r)

install.packages("pacman")
library(pacman)
p_load("fBasics", "rcompanion", "tidyverse", "metacoder", "vegan", "lme4", "car", "ggResidpanel", "performance", "patchwork")
```

## Pre-analysis
### Loading and cleaning the data 
```{r}
sample_data <- read_tsv("../data/Sample_metadata.txt")
plant_survey <- read_tsv("../data/FG_plant_survey.txt")

bact_count <- read_tsv("../data/FG_2022_Bact_ASV_counts.tsv")
allfungi_count <- read_tsv("../data/FG_2022_Fungi_ASV_counts.tsv")
AMFfungi_count <- read_tsv("../data/FG_2022_AMF_ASV_counts.tsv")

bact_taxa <- read_tsv("../data/allrank_FG_2022_Bact_ASV.fa_classified.txt")
allfungi_taxa <- read_tsv("../data/allrank_FG_2022_Fungi_ASV.fa_classified.txt")
AMFfungi_taxa <- read_tsv("../data/allrank_FG_2022_AMF_ASV.fa_classified.txt")
```

For each data set, remove the first 5 rows of text and rename the column. It will eventually contain just the ASV ID, so rename it "ASV_ID". Specify "1" because it is the first (and currently only) column in the dataframe.
```{r}
bact_taxa <- bact_taxa %>% filter(!row_number() %in% c(1:5)) 
bact_taxa <- bact_taxa %>% rename(ASV_ID = 1)

allfungi_taxa <- allfungi_taxa %>% filter(!row_number() %in% c(1:5)) 
allfungi_taxa <- allfungi_taxa %>% rename(ASV_ID = 1)

AMFfungi_taxa <- AMFfungi_taxa %>% filter(!row_number() %in% c(1:5)) 
AMFfungi_taxa <- AMFfungi_taxa %>% rename(ASV_ID = 1)
```

Then split the data in the first column into multiple columns. The deliminator here is a semicolon. This is equivalent to the "text to columns" function in Excel. The RDP taxonomy output file provides confidence scores ("cs") for each taxonomic rank. Use the "separate" function to split the data into multiple columns so that each piece of text separated by the semicolon delimiter is in its own column. Since we don't know which columns represent the true taxonomic rankings after Phylum for the fungi data sets, for now all of the columns after the "Class" ranking will be labeled as "Unkwn_number" for "Unknown".
```{r}
allfungi_taxa <- allfungi_taxa %>% 
  separate(ASV_ID, c("ASV_ID", "Symbol", "Root", "Root_cs", "Kingdom", "Kingdom_cs", "Phylum", "Phylum_cs", "Unkwn1", "Unkwn1_cs", "Unkwn2", "Unkwn2_cs", "Unkwn3", "Unkwn3_cs", "Unkwn4", "Unkwn4_cs", "Unkwn5", "Unkwn5_cs"), ";")

AMFfungi_taxa <- AMFfungi_taxa %>% 
  separate(ASV_ID, c("ASV_ID", "Symbol", "Root", "Root_cs", "Kingdom", "Kingdom_cs", "Phylum", "Phylum_cs", "Unkwn1", "Unkwn1_cs", "Unkwn2", "Unkwn2_cs", "Unkwn3", "Unkwn3_cs", "Unkwn4", "Unkwn4_cs", "Unkwn5", "Unkwn5_cs"), ";")
```

Remove Symbol, Root, and Root_cs columns.
```{r}
allfungi_taxa <- allfungi_taxa %>% 
  select(-c(Symbol, Root, Root_cs))

AMFfungi_taxa <- AMFfungi_taxa %>% 
  select(-c(Symbol, Root, Root_cs))
```

Looking more closely at the table, it's apparent that "Unkwn2" is Order and "Unkwn3" is Family. This means that "Unkwn1" must be Class and "Unkwn4" must be Genus. For some ASVs, the "Unkwn5" column contains species, but for many ASVs it just provides the genus followed by a standard "_sp" abbreviation for unknown species. The last two columns can be labeled as "Genus_Species". The letter-number string after the "|" in the Genus-Species column is a DOI that can be used for searching in databases.
```{r}
allfungi_taxa <- allfungi_taxa %>% 
  rename(Class = 6,
         Class_cs = 7,
         Order = 8,
         Order_cs = 9,
         Family = 10,
         Family_cs = 11,
         Genus = 12,
         Genus_cs = 13,
         Genus_Species = 14,
         Genus_Species_cs = 15)

AMFfungi_taxa <- AMFfungi_taxa %>% 
  rename(Class = 6,
         Class_cs = 7,
         Order = 8,
         Order_cs = 9,
         Family = 10,
         Family_cs = 11,
         Genus = 12,
         Genus_cs = 13,
         Genus_Species = 14,
         Genus_Species_cs = 15)
```

Lastly, create a duplicate fungi taxonomy table with the confidence scores removed
```{r}
allfungi_taxa_clean <- allfungi_taxa %>% 
  select(-c(Kingdom_cs, Phylum_cs, Class_cs, Order_cs, Family_cs, Genus_cs, Genus_Species_cs))

AMFfungi_taxa_clean <- AMFfungi_taxa %>% 
  select(-c(Kingdom_cs, Phylum_cs, Class_cs, Order_cs, Family_cs, Genus_cs, Genus_Species_cs))
```

The bacteria taxonomy table is a bit more complicated. It's apparent that not all rows have the same number of delimiters, which means that some ASVs were assigned a different number of taxonomic ranks than others. There are quite a lot of ASVs that were assigned an additional two or three rankings. The RDP sometimes provides Subclass and/or Suborder information for certain OTUs or ASVs. If all of the ASVs in the data set were assigned Subclass and Suborder rankings, these columns could simply be removed after the data is split into multiple columns. However, since this is true for only a subset of the ASVs, additional formatting is needed. Before beginning the formatting, split the data into multiple columns and label all of the columns after the "Class" ranking as "Unkwn_number" for "Unknown". Then remove the Symbol, Root, and Root_cs columns. 
```{r}
bact_taxa <- bact_taxa %>%
  separate(ASV_ID, c("ASV_ID", "Symbol", "Root", "Root_cs", "Kingdom", "Kingdom_cs", "Phylum", "Phylum_cs", "Class", "Class_cs", "Unkwn1", "Unkwn1_cs", "Unkwn2", "Unkwn2_cs", "Unkwn3", "Unkwn3_cs", "Unkwn4", "Unkwn4_cs", "Unkwn5", "Unkwn5_cs"), ";")

bact_taxa <- bact_taxa %>% 
  select(-c(Symbol, Root, Root_cs))
```

To format the taxonomic rankings, create a table of just the ASVs that do not have missing information for column "Unkwn5".
```{r}
Unkwn5_taxa_bact <- bact_taxa %>%
  filter(Unkwn5 != "NA")
```

There are 540 ASVs that have 2 extra taxonomic rankings. The taxon names in the "Unkwn5" column are genera and the names in the "Unkwn2" column are orders. This means that for these ASVs "Unkwn1" is Subclass, "Unkwn3" is Suborder, and "Unkwn4" is Family. Label these columns as such and then remove the Subclass and Suborder columns.
```{r}
Unkwn5_taxa_bact_labeled <- Unkwn5_taxa_bact %>% 
  rename(Subclass = 8,
         Subclass_cs = 9,
         Order = 10,
         Order_cs = 11,
         Suborder = 12,
         Suborder_cs = 13,
         Family = 14, 
         Family_cs = 15,
         Genus = 16, 
         Genus_cs = 17)

Unkwn5_taxa_bact_labeled <- Unkwn5_taxa_bact_labeled %>% 
  select(-c(Subclass, Subclass_cs, Suborder, Suborder_cs))
```

Do the same for the ASVs that have data in the "Unkwn4" columns and not in the "Unkwn5" columns.
```{r}
Unkwn4_taxa_bact <- bact_taxa %>%
  filter(Unkwn4 != "NA") %>% 
  filter(is.na(Unkwn5))
```

This data set has 1,935 ASVs which have 1 extra taxonomic ranking. Order is indicated in the "Unkwn1" column and we know that "Unkwn4" is Genus, and "Unkwn3" is Family. This means that the extra column is "Unkwn2", Suborder. Label these columns and then remove the Suborder column and "Unkwn5" columns.
```{r}
Unkwn4_taxa_bact_labeled <- Unkwn4_taxa_bact %>% 
  rename(Order = 8,
         Order_cs = 9,
         Suborder = 10,
         Suborder_cs = 11,
         Family = 12,
         Family_cs = 13,
         Genus = 14, 
         Genus_cs = 15)

Unkwn4_taxa_bact_labeled <- Unkwn4_taxa_bact_labeled %>% 
  select(-c(Suborder, Suborder_cs, Unkwn5, Unkwn5_cs))
```

Return to the master taxa table and remove all rows that have data in the "Unkwn4" column (i.e., keeping all rows for which "Unkwn4" is NA). Rows that have data in the "Unkwn5" column will also be removed by doing this since "Unkwn5" can only contain data if "Unkwn4" has data. Then remove the "Unkwn" columns.
```{r}
bact_taxa_clean <- bact_taxa %>% 
  filter(is.na(Unkwn4))
  
bact_taxa_clean <- bact_taxa_clean %>% 
  select(-c(Unkwn4, Unkwn4_cs, Unkwn5, Unkwn5_cs))  
```

Rename the columns with the correct taxonomic rankings.
```{r}
bact_taxa_clean <- bact_taxa_clean %>% 
  rename(Order = 8,
         Order_cs = 9,
         Family = 10,
         Family_cs = 11,
         Genus = 12,
         Genus_cs = 13)
```

Finally, add the Unkwn4 and Unkwn5 data sets to the cleaned master data set. Lastly, create a new table without the confidence scores.
```{r}
bact_taxa_clean <- rbind(bact_taxa_clean, Unkwn4_taxa_bact_labeled, Unkwn5_taxa_bact_labeled)

bact_taxa_clean2 <- bact_taxa_clean %>% 
  select(-c(Kingdom_cs, Phylum_cs, Class_cs, Order_cs, Family_cs, Genus_cs))
```


### Formatting the data
First, combine the taxa and count tables by matching the "ASV_ID" columns in both tables.
```{r}
bact_taxa_clean2$ASV_ID <- as.character(bact_taxa_clean2$ASV_ID)
bact_count$ASV_ID <- as.character(bact_count$ASV_ID)
bact_ASV_data <- left_join(bact_count, bact_taxa_clean2,
                           by = c("ASV_ID" = "ASV_ID"))

allfungi_taxa_clean$ASV_ID <- as.character(allfungi_taxa_clean$ASV_ID)
allfungi_count$ASV_ID <- as.character(allfungi_count$ASV_ID)
allfungi_ASV_data <- left_join(allfungi_count, allfungi_taxa_clean,
                           by = c("ASV_ID" = "ASV_ID"))

AMFfungi_taxa_clean$ASV_ID <- as.character(AMFfungi_taxa_clean$ASV_ID)
AMFfungi_count$ASV_ID <- as.character(AMFfungi_count$ASV_ID)
AMFfungi_ASV_data <- left_join(AMFfungi_count, AMFfungi_taxa_clean,
                           by = c("ASV_ID" = "ASV_ID"))
```


#### Convert to taxmap format
Create a taxmap object using the metacoder package. A taxmap object can contain multiple tables, which is useful if you want to create complimentary tables to your initial table. When these tables are in the same object, you can perform the same manipulations on multiple tables simultaneously. For now, these taxmap objects will look very similar to the "_ASV_data" tables. We can assign a taxon_id for each OTU_ID with the parse_tax_data function with class_cols parameter. The default name of the data set is tax_data, but we can give it a more intuitive title like "ASV_counts_taxa" since the data set contains counts for each ASV as well as the full taxonomy information for each ASV.
```{r}
bact_obj <- parse_tax_data(bact_ASV_data,
                            class_cols = "ASV_ID")

allfungi_obj <- parse_tax_data(allfungi_ASV_data,
                            class_cols = "ASV_ID")

AMFfungi_obj <- parse_tax_data(AMFfungi_ASV_data,
                            class_cols = "ASV_ID")

names(bact_obj$data) <- "ASV_counts_taxa"
names(allfungi_obj$data) <- "ASV_counts_taxa"
names(AMFfungi_obj$data) <- "ASV_counts_taxa"
```

```{r}
print(bact_obj)
print(allfungi_obj)
print(AMFfungi_obj)
```
Note that there are the same number of ASVs in the ASV_counts_taxa table that are in each of the "_ASV_data" tables.


#### Remove singletons
Remove low-aboundance counts from the tax_data table in the duplicate taxmap object by setting all counts with less than 2 reads (i.e., singletons) to zero.
```{r}
bact_obj$data$ASV_counts_taxa <- zero_low_counts(bact_obj, "ASV_counts_taxa", min_count = 2)
allfungi_obj$data$ASV_counts_taxa <- zero_low_counts(allfungi_obj, "ASV_counts_taxa", min_count = 2)
AMFfungi_obj$data$ASV_counts_taxa <- zero_low_counts(AMFfungi_obj, "ASV_counts_taxa", min_count = 2)
```
Found 63,573 counts of less than 2 (out of 2,061,918 counts total) for bacteria.
Found 2,415 counts of less than 2 (out of 436,848 counts total) for all fungi.
Found 1,721 counts of less than 2 (out of 299,649 counts total) for AMF fungi.

Now there are ASVs that no longer contain any observations, as can be seen with the following.
```{r}
no_reads_bact <- rowSums(bact_obj$data$ASV_counts_taxa[, sample_data$sample_id]) == 0
sum(no_reads_bact)

no_reads_allfungi <- rowSums(allfungi_obj$data$ASV_counts_taxa[, sample_data$sample_id]) == 0
sum(no_reads_allfungi)

no_reads_AMFfungi <- rowSums(AMFfungi_obj$data$ASV_counts_taxa[, sample_data$sample_id]) == 0
sum(no_reads_AMFfungi)
```

There are now 8,911 bacterial ASVs, 7 all fungal ASVs, and no AMF fungal ASVs that have no reads. These ASVs can be removed using filter_obs, which is used to filter data associated with a taxonomy in a taxmap object. 
```{r}
bact_obj <- filter_obs(bact_obj, data = "ASV_counts_taxa", ! no_reads_bact, drop_taxa = TRUE)
allfungi_obj <- filter_obs(allfungi_obj, data = "ASV_counts_taxa", ! no_reads_allfungi, drop_taxa = TRUE)
AMFfungi_obj <- filter_obs(AMFfungi_obj, data = "ASV_counts_taxa", ! no_reads_AMFfungi, drop_taxa = TRUE)
```

```{r}
print(bact_obj)
print(allfungi_obj)
print(AMFfungi_obj)
```
We can see that the number of rows decreased in the ASV_counts_taxa tables by the exact number of ASVs that were updated to have no reads. 


Remove singletons from bact_ASV_data table.
```{r}
bact_ASV_data2 <- bact_ASV_data %>%
  filter(if_any(where(is.numeric), ~ . > 1))
```


#### Account for un-even sampling
To account for un-even sampling, convert counts to proportions  (i.e., relative abundance) and add the results to each taxmap object in a new table called "ASV_props".
```{r}
bact_obj$data$ASV_props <- calc_obs_props(bact_obj, "ASV_counts_taxa")
allfungi_obj$data$ASV_props <- calc_obs_props(allfungi_obj, "ASV_counts_taxa")
AMFfungi_obj$data$ASV_props <- calc_obs_props(AMFfungi_obj, "ASV_counts_taxa")
```

Now the data are ready for analysis.



## Analysis

### Assign life history strategies for bacterial taxa (i.e., oligotrophic and copiotrophic)

First, create a duplicate table of the bact_ASV_data2 table. Then select just the ASV_ID and taxonomy information columns.
```{r}
bact_functions <- bact_ASV_data2

bact_functions <- bact_functions %>% 
  select(ASV_ID, Kingdom, Phylum, Class, Order, Family, Genus)
```

Import table with oligotrophic and copiotrophic life history strategy assignments. 
```{r}
bact_life_strategy_assignments <- read_tsv("../data/bact_life_strategy_assignments_Stone2023.txt")
```

If the Genus column matches
```{r}
bact_life_strategy_assignments_abbv <- bact_life_strategy_assignments %>% 
  select(Genus, life_strategy)

bact_functions <- left_join(bact_functions, bact_life_strategy_assignments_abbv, by = "Genus")
```

Identify proportion of ASVs that belong to oligtrophic or copiotrophic taxa by filtering the data table for only rows in which life_strategy has data (i.e., is not coded as “NA”).
```{r}
bact_functions %>% 
  filter(life_strategy != "NA") %>% 
  nrow()
```

```{r}
nrow(bact_functions)
```

```{r}
3070/27263
```
These oligotrophic and copiotrophic taxa account for approximately 11% of the total bacterial diversity.

Identify proportion of sequences that belong to oligotrophic or copiotrophic taxa. First, create a new table called life_strategies_ASV_counts by selecting just the ASV_ID and life_strategy columns from the bact_functions table. Then join the count data from the bact_ASV_data2 table, matching the tables by ASV_ID. Then create a new table that keeps only the rows for which life strategy is defined. From this new table, remove the taxonomy and life_strategy columns and transform the ASV_ID column to row names (the table needs to be pared down to just numerical data since we will sum across all columns). Then add a column that calculates the total number of sequences for each row. Then calculate the sum of all sequences. 
```{r}
life_strategies_ASV_counts <- bact_functions %>% 
  select(c("ASV_ID", "life_strategy"))

life_strategies_ASV_counts <- left_join(bact_ASV_data2, life_strategies_ASV_counts,
                                             by = "ASV_ID")

life_strategies_ASV_counts2 <- life_strategies_ASV_counts %>% 
  filter(life_strategy != "NA")

life_strategies_ASV_counts2 <- life_strategies_ASV_counts2 %>%
  select(-c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "life_strategy")) %>% 
  tibble::column_to_rownames("ASV_ID")

life_strategies_ASV_counts2 <- life_strategies_ASV_counts2 %>%
  mutate(Seq_sum = rowSums(.,))

sum(life_strategies_ASV_counts2$Seq_sum)
```

Create an abbreviated life_strategies_ASV_counts table that has taxonomy and life strategy columns removed. Repeat the same last two steps as above to calculate the total number of all bacterial sequences. 
```{r}
life_strategies_ASV_counts_abbv <- life_strategies_ASV_counts %>%
  select(-c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "life_strategy")) %>% 
  tibble::column_to_rownames("ASV_ID")

life_strategies_ASV_counts_abbv <- life_strategies_ASV_counts_abbv %>%
  mutate(Seq_sum = rowSums(.,))

sum(life_strategies_ASV_counts_abbv$Seq_sum) 
```

Finally, divide the two sums to calculate the proportion of bacterial sequences that belong to oligotrophic or copiotrophic taxa.
```{r}
(801310/3789016)*100
```
Approximately 21% of the total number of bacterial sequences belong to oligotrophic or copiotrophic taxa.


Ultimately, we need oligotrophic richness, oligotrophic abundance, copiotrophic richness, and copiotrophic abundance for each sample.
life_strategies_ASV_counts: all ASVs (singletons removed) 
life_strategies_ASV_counts2: only ASVs with life strategy assigned (singletons removed)

We need count table of all ASVs (singletons removed) with life strategy column 

Using the life_strategies_ASV_counts table, make a new table that just the life_strategy column retained (i.e., without the taxonomy columns).
```{r}
life_strategies_ASV_counts_no_tax <- life_strategies_ASV_counts %>%
  select(-c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus")) 
```

Melt the table so that ASV count is its own column, using the reshape2 package.
```{r}
install.packages("reshape2")
library(reshape2)

life_strategies_ASV_counts_melted <- melt(life_strategies_ASV_counts_no_tax, id = c("ASV_ID", "life_strategy"))
```

Create tables of total richness and oligotrophic and copiotrophic richness for each sample. To calculate total richness: group by variable (i.e., sample), then filter by rows that have a count of greater than 1 (i.e., that ASV is present in the sample), then tally (i.e., count) the number rows (i.e., ASVs) and display this count in a column called "total_rich". To calculate richness of oligotrophs and richness of copiotrophs: group by variable, filter by rows that have a count greater than 1, then filter by rows that are assigned as oligotrophic or copiotrophic and count the number of rows and display this count in columns called "oligo_rich" and "copio_rich".
```{r}
bact_rich <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>%
  filter(value > 0) %>%
  tally(., name = "total_rich")

bact_oligo_rich <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>% 
  filter(value > 0) %>%
  filter(life_strategy == "Oligotrophic") %>% 
  tally(., name = "oligo_rich")

bact_copio_rich <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>% 
  filter(value > 0) %>%
  filter(life_strategy == "Copiotrophic") %>% 
  tally(., name = "copio_rich")
```

Create tables of total abundance and oligotrophic and copiotrophic abundance for each sample. To calculate total abundance: group by variable, count the number in the value column which represent sequence counts, and display in a column called "total_abund". To calculate oligotrophic and copiotrophic abundance: group by variable, filter by rows that are assigned as oligotrophic or copiotrophic, and count the number in the value column and display in columns called "oligo_abund" and "copio_abund".
```{r}
bact_abund <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>% 
  tally(value, name = "total_abund")

bact_oligo_abund <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>% 
  filter(life_strategy == "Oligotrophic") %>% 
  tally(value, name = "oligo_abund")

bact_copio_abund <- life_strategies_ASV_counts_melted %>% 
  group_by(variable) %>% 
  filter(life_strategy == "Copiotrophic") %>% 
  tally(value, name = "copio_abund")
```

Combine these tables into one data frame and rename columns. 
```{r}
bact_oligo_copio_table <- cbind(bact_rich, bact_abund$total_abund, bact_oligo_rich$oligo_rich, bact_copio_rich$copio_rich, bact_oligo_abund$oligo_abund, bact_copio_abund$copio_abund)
  
bact_oligo_copio_table <- bact_oligo_copio_table %>%
  rename(sample_id = 1,
         total_bact_rich = 2,
         total_bact_abund = 3, 
         bact_oligo_rich = 4,
         bact_copio_rich = 5,
         bact_oligo_abund = 6, 
         bact_copio_abund = 7)
```

Create oligo and copio proportions columns.
```{r}
bact_oligo_copio_table <- bact_oligo_copio_table %>% 
  mutate(bact_oligo_rich_prop = bact_oligo_rich/total_bact_rich,
         bact_copio_rich_prop = bact_copio_rich/total_bact_rich,
         bact_oligo_abund_prop = bact_oligo_abund/total_bact_abund,
         bact_copio_abund_prop = bact_copio_abund/total_bact_abund)
```

Add this table to the sample_data table, aligning by sample_id column in both tables.
```{r}
sample_data <- left_join(sample_data, bact_oligo_copio_table, by = "sample_id")
```


### Hypothesis testing: Management type
Hypothesis 1A: We hypothesize that copiotrophic microbial taxa will increase in relative abundance in remnant soils relative to restoration soils. 
Hypothesis 1B: We hypothesize that an increase in copiotrophic taxa would yield faster C mineralization rates in remnant soils relative to those in restoration soils. 

Specifically: 
- Remnant soils will have higher extracellular enzyme activity rates compared to restoration soils
- Relative abundance of copiotrophic taxa will be positively correlated with extracellular enzyme activity rates

For the relative abundance microbial data, we will use binomial GLMs (generalized linear models).

#### Hypothesis 1A
Test for differences in copiotrophic richness among remnant and restoration soils.
```{r}
copio_rich_management_mixed_model <- glmer(cbind(bact_copio_rich, total_bact_rich) ~ management_type + (1|habitat_type_google_maps), 
                             family = binomial,
                             data = sample_data)

copio_rich_management_model <- glm(cbind(bact_copio_rich, total_bact_rich) ~ management_type, 
                             family = binomial,
                             data = sample_data)

resid_panel(copio_rich_management_model, smoother = TRUE, qqbands = TRUE)
plot(copio_rich_management_model)
```


```{r}
summary(copio_rich_management_model)
```
P-value is above the 0.05 threshold. Copiotrophic richness is similar among remnant and restoration soils.


```{r}
copio_rich_management_model2 <- glm(bact_copio_rich ~ management_type + 
                                    offset(log(total_bact_rich)),
                                    family = "poisson",
                                    data = sample_data)
```

```{r}
plot(copio_rich_management_model2)
```

```{r}
summary(copio_rich_management_model2)
```



Test for differences in oligotrophic richness among remnant and restoration soils.
```{r}
oligo_rich_management_mixed_model <- glmer(cbind(bact_oligo_rich, total_bact_rich) ~ management_type + (1|transect), 
                             family = binomial,
                             data = sample_data)

oligo_rich_management_model <- glm(cbind(bact_oligo_rich, total_bact_rich) ~ management_type, 
                             family = binomial,
                             data = sample_data)

resid_panel(oligo_rich_management_model, smoother = TRUE, qqbands = TRUE)
```

```{r}
summary(oligo_rich_management_model)
```
P-value is above the 0.05 threshold. Oligotrophic richness is similar among remnant and restoration soils.


Figures of copiotrophic and oligotrophic richness among remnant and restoration soils.
```{r}
copio_rich_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = bact_copio_rich_prop)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  scale_y_continuous(limits = c(0.382, 0.426), breaks = c(0.39, 0.40, 0.41, 0.42)) +
  xlab("\nLand management type") + 
  ylab("Proportion copiotrophic (richness)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none")

oligo_rich_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = bact_oligo_rich_prop)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  xlab("\nLand management type") + 
  ylab("Proportion oligotrophic (richness)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none")
```

Arrange figures side-by-side using the patchwork package.
```{r}
(management_by_rich_patch <- copio_rich_management_boxplot + oligo_rich_management_boxplot) 
```


Test for differences in copiotrophic abundance among remnant and restoration soils.
```{r}
management_copio_abund_mixed_model <- glmer(cbind(bact_copio_abund, total_bact_abund) ~ management_type + (1|transect), 
                             family = binomial,
                             data = sample_data)

resid_panel(copio_abund_management_mixed_model, smoother = TRUE, qqbands = TRUE)
```
```{r}
summary(copio_abund_management_mixed_model)
```


```{r}
Anova(copio_abund_management_mixed_model, type = 2)
```
P-value is well below the 0.05 threshold. Copiotrophic richness is very different among remnant and restoration soils.


Test for differences in oligotrophic abundance among remnant and restoration soils.
```{r}
oligo_abund_management_mixed_model <- glmer(cbind(bact_oligo_abund, total_bact_abund) ~ management_type + (1|transect), 
                             family = binomial,
                             data = sample_data)

oligo_abund_management_model <- glm(cbind(bact_oligo_abund, total_bact_abund) ~ management_type, 
                             family = binomial,
                             data = sample_data)

resid_panel(oligo_abund_management_model, smoother = TRUE, qqbands = TRUE)
```

```{r}
summary(oligo_abund_management_model)
```
P-value is well below the 0.05 threshold. Oligotrophic richness is very different among remnant and restoration soils.


Figures of copiotrophic and oligotrophic abundance among remnant and restoration soils.
```{r}
copio_abund_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = bact_copio_abund_prop)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  xlab("\nLand management type") + 
  ylab("Proportion copiotrophic (abundance)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none")

oligo_abund_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = bact_oligo_abund_prop)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  scale_y_continuous(breaks = c(0.46, 0.48, 0.50, 0.52, 0.54)) +
  xlab("\nLand management type") + 
  ylab("Proportion oligotrophic (abundance)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none")
```

Arrange figures side-by-side.
```{r}
management_by_abund_patch <- copio_abund_management_boxplot + oligo_abund_management_boxplot
```


```{r}
(management_by_rich_patch/management_by_abund_patch)
```



#### Hypothesis 1B

Test for differences in beta-glucosidase rates among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$BG_nmol_g_hr)
normalTest(sample_data$BG_nmol_g_hr, method = c("sw"))
```

```{r}
plotNormalHistogram(log(sample_data$BG_nmol_g_hr))
normalTest(log(sample_data$BG_nmol_g_hr), method = c("sw"))

sample_data <- sample_data %>% 
  mutate(BG_nmol_g_hr_log = log(BG_nmol_g_hr)) %>% 
  relocate(BG_nmol_g_hr_log, .after = BG_nmol_g_hr)
```

```{r}
BG_management_mixed_mod <- lmer(BG_nmol_g_hr_log ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)
plot(BG_management_mixed_mod)
```

```{r}
summary(BG_management_mixed_mod)
```

```{r}
Anova(BG_management_mixed_mod, type = 2)
```


Test for differences in cellobiohydrolase rates among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$CBH_nmol_g_hr)
normalTest(sample_data$CBH_nmol_g_hr, method = c("sw"))
```

```{r}
CBH_management_mixed_mod <- lmer(CBH_nmol_g_hr ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)

plot(CBH_management_mixed_mod)
```

```{r}
summary(CBH_management_mixed_mod)
```

```{r}
Anova(CBH_management_mixed_mod, type = 2)
```
p-value is well above the 0.05 threshold. Cellulose degradation rates are very similar among remnant and restoration soils.



Test for differences in N-acetyl-ϐ-D-glucosaminidase rates among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$NAG_nmol_g_hr)
normalTest(sample_data$NAG_nmol_g_hr, method = c("sw"))

plotNormalHistogram(log(sample_data$NAG_nmol_g_hr))
normalTest(log(sample_data$NAG_nmol_g_hr), method = c("sw"))
```

```{r}
sample_data <- sample_data %>% 
  mutate(NAG_nmol_g_hr_log = log(NAG_nmol_g_hr)) %>% 
  relocate(NAG_nmol_g_hr_log, .after = NAG_nmol_g_hr)
```

```{r}
NAG_management_mixed_mod <- lmer(NAG_nmol_g_hr_log ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)
plot(NAG_management_mixed_mod)
```

```{r}
summary(NAG_management_mixed_mod)
```

```{r}
Anova(NAG_management_mixed_mod, type = 2)
```
p-value is slightly above the 0.05 threshold. Chitin degradation rates are slightly higher in remnant compared to restoration soils.


```{r}
(NAG_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = NAG_nmol_g_hr)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  scale_y_continuous(breaks = c(50, 100, 150, 200, 250)) +
  xlab("\nLand management type") + 
  ylab("NAG (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```


Test for differences in beta-xylosidase rates among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$BX_nmol_g_hr)
normalTest(sample_data$BX_nmol_g_hr, method = c("sw"))
plotNormalHistogram(log(sample_data$BX_nmol_g_hr))
```

```{r}
BX_management_mixed_mod <- glmer(BX_nmol_g_hr ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)
plot(BX_management_mixed_mod)
```

```{r}
summary(BX_management_mixed_mod)
```

```{r}
Anova(BX_management_mixed_mod, type = 2)
```
p-values is below the 0.05 threshold. Hemicellulose degradation rates are greater in remnant compared to restoration soils.

```{r}
(BX_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = BX_nmol_g_hr)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  scale_y_continuous(breaks = c(30, 60, 90, 120)) +
  xlab("\nLand management type") + 
  ylab("BX (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```


Test for differences in alpha-glucosidase rates among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$AG_nmol_g_hr)
normalTest(sample_data$AG_nmol_g_hr, method = c("sw"))
```

```{r}
sample_data <- sample_data %>% 
  mutate(AG_nmol_g_hr_transformed = AG_nmol_g_hr + 20) %>% 
  relocate(AG_nmol_g_hr_transformed, .after = AG_nmol_g_hr)
```

```{r}
plotNormalHistogram(sample_data$AG_nmol_g_hr_transformed)
normalTest(sample_data$AG_nmol_g_hr_transformed, method = c("sw"))
plotNormalHistogram(log(sample_data$AG_nmol_g_hr_transformed))
normalTest(log(sample_data$AG_nmol_g_hr_transformed), method = c("sw"))
```

```{r}
AG_management_mixed_mod <- lmer(AG_nmol_g_hr_transformed ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)
plot(AG_management_mixed_mod)
```

```{r}
summary(AG_management_mixed_mod)
```

```{r}
Anova(AG_management_mixed_mod, type = 2)
```
p-value is well above the 0.05 threshold. Glucose degradation rates are very similar among remnant and restoration soils.


Test for differences in leucine aminopeptidase among remnant and restoration soils.
```{r}
plotNormalHistogram(sample_data$LAP_nmol_g_hr)
normalTest(sample_data$LAP_nmol_g_hr, method = c("sw"))
```

```{r}
sample_data <- sample_data %>% 
  mutate(LAP_nmol_g_hr_transformed = LAP_nmol_g_hr + 30) %>% 
  relocate(LAP_nmol_g_hr_transformed, .after = LAP_nmol_g_hr)
```

```{r}
plotNormalHistogram(sample_data$LAP_nmol_g_hr_transformed)
normalTest(sample_data$LAP_nmol_g_hr_transformed, method = c("sw"))
plotNormalHistogram(log(sample_data$LAP_nmol_g_hr_transformed))
normalTest(log(sample_data$LAP_nmol_g_hr_transformed), method = c("sw"))
```

```{r}
LAP_management_mixed_mod <- glmer(LAP_nmol_g_hr_transformed ~ management_type + (1|habitat_type_google_maps) + (1|transect), data = sample_data)
plot(LAP_management_mixed_mod)
```

```{r}
summary(LAP_management_mixed_mod)
```

```{r}
Anova(LAP_management_mixed_mod, type = 2)
```
p-value is well above the 0.05 threshold. Protein degradation rates are very similar among remnant and restoration soils.


```{r}
(CBH_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = CBH_nmol_g_hr)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  scale_y_continuous(breaks = c(50, 100, 150, 200, 250)) +
  xlab("\nLand management type") + 
  ylab("BG (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```

```{r}
(AG_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = AG_nmol_g_hr_transformed)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  xlab("\nLand management type") + 
  ylab("AG (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```

```{r}
(BG_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = BG_nmol_g_hr)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  xlab("\nLand management type") + 
  ylab("BG (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```

```{r}
(LAP_management_boxplot <- ggplot(sample_data, aes(x = management_type, y = LAP_nmol_g_hr_transformed)) +
  geom_boxplot(aes(fill = management_type), width = 0.5, lwd = 0.5) +
  scale_fill_manual(values = c("#4363d8", "darkgoldenrod1")) +
  xlab("\nLand management type") + 
  ylab("LAP (nmol per g per hour)") +
  theme_classic(base_size = 10, base_family = "") +
  theme(panel.border = element_rect(linetype = "solid", fill = NA, linewidth = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(face = "plain", color = "black", size = 12),
        axis.text.y = element_text(face = "plain", color = "black", size = 14),
        axis.ticks.length = unit(0.15, "cm"),
        axis.ticks.x = element_blank(),
        axis.line = element_line(linewidth = 0.5),
        legend.position = "none"))
```

```{r}
(enzyme_management_top_panel_figs <- BX_management_boxplot + NAG_management_boxplot)
(enzyme_management_bottom_panel_figs <- AG_management_boxplot + BG_management_boxplot + CBH_management_boxplot)
(enzyme_management_figs <- enzyme_management_top_panel_figs/enzyme_management_bottom_panel_figs)
```

What microbes are important for hemicellulose and chitin degradation?



#### Hypothesis 3 
Richness and/or abundance of copiotrophic, oligotrophic taxa are correlated to carbon substrate degradation rates.

Alpha-glucosidase
```{r}
copio_rich_AG_mixed_mod <- lmer(AG_nmol_g_hr_transformed ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_AG_mixed_mod)
```

```{r}
summary(copio_rich_AG_mixed_mod)
```

```{r}
Anova(copio_rich_AG_mixed_mod, type = 2)
```



```{r}
copio_abund_AG_mixed_mod <- lmer(AG_nmol_g_hr_transformed ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_AG_mixed_mod)
```

```{r}
summary(copio_abund_AG_mixed_mod)
```

```{r}
Anova(copio_abund_AG_mixed_mod, type = 2)
```

```{r}
oligo_rich_AG_mixed_mod <- lmer(AG_nmol_g_hr_transformed ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_AG_mixed_mod)
```

```{r}
summary(oligo_rich_AG_mixed_mod)
```

```{r}
Anova(oligo_rich_AG_mixed_mod, type = 2)
```


```{r}
oligo_abund_AG_mixed_mod <- lmer(AG_nmol_g_hr_transformed ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_abund_AG_mixed_mod)
```

```{r}
summary(oligo_abund_AG_mixed_mod)
```

```{r}
Anova(oligo_abund_AG_mixed_mod, type = 2)
```



Beta-glucosidase
```{r}
copio_rich_BG_mixed_mod <- lmer(BG_nmol_g_hr_log ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_BG_mixed_mod)
```

```{r}
summary(copio_rich_BG_mixed_mod)
```

```{r}
Anova(copio_rich_BG_mixed_mod, type = 2)
```

```{r}
copio_abund_BG_mixed_mod <- lmer(BG_nmol_g_hr_log ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_BG_mixed_mod)
```

```{r}
summary(copio_abund_BG_mixed_mod)
```

```{r}
Anova(copio_abund_BG_mixed_mod, type = 2)
```

```{r}
oligo_rich_BG_mixed_mod <- lmer(BG_nmol_g_hr_log ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_BG_mixed_mod)
```

```{r}
summary(oligo_rich_BG_mixed_mod)
```

```{r}
Anova(oligo_rich_BG_mixed_mod, type = 2)
```

```{r}
oligo_abund_BG_mixed_mod <- lmer(BG_nmol_g_hr_log ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_abund_BG_mixed_mod)
```

```{r}
summary(oligo_abund_BG_mixed_mod)
```

```{r}
Anova(oligo_abund_BG_mixed_mod, type = 2)
```


Cellobiohydrolase
```{r}
copio_rich_CBH_mixed_mod <- lmer(CBH_nmol_g_hr ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_CBH_mixed_mod)
```

```{r}
summary(copio_rich_CBH_mixed_mod)
```

```{r}
Anova(copio_rich_CBH_mixed_mod, type = 2)
```


```{r}
copio_abund_CBH_mixed_mod <- lmer(CBH_nmol_g_hr ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_CBH_mixed_mod)
```

```{r}
summary(copio_abund_CBH_mixed_mod)
```

```{r}
Anova(copio_abund_CBH_mixed_mod, type = 2)
```

```{r}
oligo_rich_CBH_mixed_mod <- lmer(CBH_nmol_g_hr ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_CBH_mixed_mod)
```


```{r}
summary(oligo_rich_CBH_mixed_mod)
```

```{r}
Anova(oligo_rich_CBH_mixed_mod, type = 2)
```

```{r}
oligo_abund_CBH_mixed_mod <- lmer(CBH_nmol_g_hr ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_CBH_mixed_mod)
```

```{r}
summary(oligo_abund_CBH_mixed_mod)
```

```{r}
Anova(oligo_abund_CBH_mixed_mod, type = 2)
```


Beta-xylosidase
```{r}
copio_rich_BX_mixed_mod <- glmer(BX_nmol_g_hr ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_BX_mixed_mod)
```

```{r}
summary(copio_rich_BX_mixed_mod)
```

```{r}
Anova(copio_rich_BX_mixed_mod, type = 2)
```

```{r}
copio_abund_BX_mixed_mod <- glmer(BX_nmol_g_hr ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_BX_mixed_mod)
```

```{r}
summary(copio_abund_BX_mixed_mod)
```

```{r}
Anova(copio_abund_BX_mixed_mod, type = 2)
```

```{r}
model_performance(copio_abund_BX_mixed_mod)
```


```{r}
cor.test(sample_data$bact_copio_abund_prop, sample_data$BX_nmol_g_hr)
```

```{r}
copio_abund_BX_scatterplot <- ggplot(sample_data, aes(x = bact_copio_abund_prop, y = BX_nmol_g_hr)) +
    geom_smooth(method = "lm", color = "grey50") + 
    geom_point(shape = 21, size = 2, stroke = 0.75) +
    xlab("Proportion copiotrophic (abundance)") + 
    ylab("BX") +
    theme_classic(base_size = 10, base_family = "") +
    theme(panel.border = element_rect(linetype = "solid", fill = NA, size = 1),
          axis.title = element_blank(),
          axis.text.x = element_text(face = "plain", color = "black", size = 8),
          axis.text.y = element_text(face = "plain", color = "black", size = 10),
          axis.ticks.length = unit(0.15, "cm"),
          axis.line = element_line(size = 0.5),
          legend.position = "none")
```


```{r}
oligo_rich_BX_mixed_mod <- glmer(BX_nmol_g_hr ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_BX_mixed_mod)
```

```{r}
summary(oligo_rich_BX_mixed_mod)
```

```{r}
Anova(oligo_rich_BX_mixed_mod, type = 2)
```

```{r}
oligo_abund_BX_mixed_mod <- glmer(BX_nmol_g_hr ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_abund_BX_mixed_mod)
```

```{r}
summary(oligo_abund_BX_mixed_mod)
```

```{r}
Anova(oligo_abund_BX_mixed_mod, type = 2)
```

```{r}
oligo_abund_BX_scatterplot <- ggplot(sample_data, aes(x = bact_oligo_abund_prop, y = BX_nmol_g_hr)) +
    geom_point(shape = 21, size = 2, stroke = 0.75) +
    xlab("Proportion oligotrophic (abundance)") + 
    ylab("BX") +
    theme_classic(base_size = 10, base_family = "") +
    theme(panel.border = element_rect(linetype = "solid", fill = NA, size = 1),
          axis.title = element_blank(),
          axis.text.x = element_text(face = "plain", color = "black", size = 8),
          axis.text.y = element_text(face = "plain", color = "black", size = 10),
          axis.ticks.length = unit(0.15, "cm"),
          axis.line = element_line(size = 0.5),
          legend.position = "none")
```



N-acetyl-ϐ-D-glucosaminidase
```{r}
copio_rich_NAG_mixed_mod <- lmer(NAG_nmol_g_hr_log ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_NAG_mixed_mod)
```

```{r}
summary(copio_rich_NAG_mixed_mod)
```

```{r}
Anova(copio_rich_NAG_mixed_mod, type = 2)
```

```{r}
copio_abund_NAG_mixed_mod <- lmer(NAG_nmol_g_hr_log ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_NAG_mixed_mod)
```

```{r}
summary(copio_abund_NAG_mixed_mod)
```

```{r}
Anova(copio_abund_NAG_mixed_mod, type = 2)
```

```{r}
model_performance(copio_abund_NAG_mixed_mod)
```


```{r}
oligo_rich_NAG_mixed_mod <- lmer(NAG_nmol_g_hr_log ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_NAG_mixed_mod)
```

```{r}
summary(oligo_rich_NAG_mixed_mod)
```

```{r}
Anova(oligo_rich_NAG_mixed_mod, type = 2)
```

```{r}
oligo_abund_NAG_mixed_mod <- lmer(NAG_nmol_g_hr_log ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_abund_NAG_mixed_mod)
```

```{r}
summary(oligo_abund_NAG_mixed_mod)
```

```{r}
Anova(oligo_abund_NAG_mixed_mod, type = 2)
```

```{r}
copio_abund_NAG_scatterplot <- ggplot(sample_data, aes(x = bact_copio_abund_prop, y = NAG_nmol_g_hr)) +
    geom_smooth(method = "lm", color = "grey50") + 
    geom_point(shape = 21, size = 2, stroke = 0.75) +
    scale_y_continuous(breaks = c(0, 50, 100, 150, 200, 250)) +
    xlab("Proportion copiotrophic (abundance)") + 
    ylab("NAG") +
    theme_classic(base_size = 10, base_family = "") +
    theme(panel.border = element_rect(linetype = "solid", fill = NA, size = 1),
          axis.title = element_blank(),
          axis.text.x = element_text(face = "plain", color = "black", size = 8),
          axis.text.y = element_text(face = "plain", color = "black", size = 10),
          axis.ticks.length = unit(0.15, "cm"),
          axis.line = element_line(size = 0.5),
          legend.position = "none")
```


```{r}
oligo_abund_NAG_scatterplot <- ggplot(sample_data, aes(x = bact_oligo_abund_prop, y = NAG_nmol_g_hr)) +
    geom_point(shape = 21, size = 2, stroke = 0.75) +
    scale_y_continuous(breaks = c(0, 50, 100, 150, 200, 250)) +
    xlab("Proportion oligotrophic (abundance)") + 
    ylab("NAG") +
    theme_classic(base_size = 10, base_family = "") +
    theme(panel.border = element_rect(linetype = "solid", fill = NA, size = 1),
          axis.title = element_blank(),
          axis.text.x = element_text(face = "plain", color = "black", size = 8),
          axis.text.y = element_text(face = "plain", color = "black", size = 10),
          axis.ticks.length = unit(0.15, "cm"),
          axis.line = element_line(size = 0.5),
          legend.position = "none")
```


```{r}
(copio_abund_BX_scatterplot + copio_abund_NAG_scatterplot)/(oligo_abund_BX_scatterplot + oligo_abund_NAG_scatterplot)
```


Leucine aminopeptidase
```{r}
copio_rich_LAP_mixed_mod <- glmer(LAP_nmol_g_hr_transformed ~ bact_copio_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_rich_LAP_mixed_mod)
```

```{r}
summary(copio_rich_LAP_mixed_mod)
```

```{r}
Anova(copio_rich_LAP_mixed_mod, type = 2)
```

```{r}
copio_abund_LAP_mixed_mod <- glmer(LAP_nmol_g_hr_transformed ~ bact_copio_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(copio_abund_LAP_mixed_mod)
```

```{r}
summary(copio_abund_LAP_mixed_mod)
```

```{r}
Anova(copio_abund_LAP_mixed_mod, type = 2)
```

```{r}
oligo_rich_LAP_mixed_mod <- glmer(LAP_nmol_g_hr_transformed ~ bact_oligo_rich_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_rich_LAP_mixed_mod)
```

```{r}
summary(oligo_rich_LAP_mixed_mod)
```

```{r}
Anova(oligo_rich_LAP_mixed_mod, type = 2)
```

```{r}
oligo_abund_LAP_mixed_mod <- glmer(LAP_nmol_g_hr_transformed ~ bact_oligo_abund_prop + (1|management_type) + (1|habitat_type_google_maps), data = sample_data)

plot(oligo_abund_LAP_mixed_mod)
```

```{r}
summary(oligo_abund_LAP_mixed_mod)
```

```{r}
Anova(oligo_abund_LAP_mixed_mod, type = 2)
```

